$vmName = "Test Build HKTC"
$screenshotPath = "C:\Desktop"
$hyperVServer = "blade5.btrusteng.com"

# Establish a remote PowerShell session to the Hyper-V server
$session = New-PSSession -ComputerName $hyperVServer

# Take a screenshot of the virtual machine
Invoke-Command -Session $session -ScriptBlock {
    param($vmName, $screenshotPath)

    # Get the virtual machine
    $vm = Get-VM -Name $vmName

    # Take the screenshot
    $screenshot = Save-VMConsoleScreenshot -VM $vm

    # Save the screenshot to the specified path
    $screenshot | Export-VMConsoleScreenshot -Path $screenshotPath
} -ArgumentList $vmName, $screenshotPath

# Close the remote PowerShell session
Remove-PSSession $session
